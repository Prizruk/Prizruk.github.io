<!DOCTYPE html>
<html>
<head>   
	<script>
		var givenMinutes = 1;
		var start = 0;
		var delta = 1;
		var correct = 0;
		const startedTimer = false;
		const answers = [3,[0,0,1,1]];
		
		//Сбрасываем кнопки и время
		function resetAll(){
			document.getElementById("id_clock").hidden = true;
			for (let i = 0; i < answers.length; i++){
				const buttons = document.querySelectorAll('input[name="q'+(i+1)+'*"]');
				for (const button of buttons) {
					if (button.type == "radio" || button.type == "checkbox") {
						button.checked = false;
					}
					else {
						button.value = '';
					}
				}
			}
			document.getElementById("questions").hidden = true;

		}
		//Запускаем тест и таймер
		function setupTest(){
			start = Date.now() + givenMinutes*1000*60;
			delta = start - Date.now();

			document.getElementById("id_clock").hidden = false;
			document.getElementById("questions").hidden = false;
			document.getElementById("startTestButton").disabled = true;
		}
		
		//Проверяем данные перед запуском теста
		function checkInfo(){
			const checkname = document.getElementById('qname');
			if (!checkname.validity.valid){
				alert("ФИО введено неправильно");
				return;
			}
			const checkemail = document.getElementById('qemail');
			if (!checkemail.validity.valid){
				alert("email введён неправильно");
				return;
			}
			setupTest();
		}
		
		//Проверяем ответы
		function checkAnswers(){
			for (let i = 0; i < answers.length; i++){
				const buttons = document.querySelectorAll('input[name="q'+(i+1)+'"]');
				const corq = document.getElementById('question'+(i+1));
				//Автоматически неправильный, пока не правильный
				corq.style.color = "red";
				switch (buttons[0].type) {
					case 'radio':
						for (const button of buttons) {
							if (button.checked) {
								console.log(button.value);
								if (button.value == answers[i]){
									checkRight(corq);
									break;
								}
							}				
						}
						break;
					case 'checkbox':
						
						for (let j = 0; j < buttons.length; j++){
							if (buttons[i].checked != answers[i][j])
								break;
						}
						checkRight(corq);
						break;
				}
			}
		}
		
		//Отмечаем правильный ответ
		function checkRight(corq){
			correct += 1;
			corq.style.color = "green";
		}
		
		//Убираем и выключаем по истечении времени
		function disableOnTimeout() {
			startedTimer = false;
			window.alert("Ваше время истекло");
			for (let i = 0; i < answers.length; i++){
				const buttons = document.querySelectorAll('input[name="q'+(i+1)+'"]');
				for (const button of buttons) {
					button.disabled = true;
				}
			}
			checkAnswers();
		}
		
		//Таймер
		function digitalClock() {
			var timertext = "Осталось "
			if (startedTimer){
				delta = start - Date.now();
				if (delta <= 0){
					givenMinutes = 0;
					disableOnTimeout();
				}
				else {
					var seconds = Math.floor(delta/1000);
					var minutes = 0;
					if (seconds > 60){
						minutes = Math.floor(seconds/60);
						seconds = seconds % 60;
					}
					//Добавление ведущих нулей и компановка
					if (minutes < 10) timertext += "0";
					timertext += minutes + ":";
					if (seconds < 10) timertext += "0";
					timertext += seconds;
					document.getElementById("id_clock").innerHTML = timertext;
					setTimeout("digitalClock()", 1000);
				}
			}
			else {
				if (givenMinutes < 10) timertext += "0";
				timertext += givenMinutes + ":00";
				document.getElementById("id_clock").innerHTML = timertext;
				setTimeout("digitalClock()", 1000);			
			}
		}

	</script>
	<title>Тест теста</title>
	<link rel="icon" type="image/x-icon" href="favicon.png">
	<style>
		input:invalid {
			border: red solid 3px;
		}
	</style>
</head>
<body onload="resetAll()">
	<h1>Тестовая версия тестовой страницы с тестом теста</h1>
	<h2>Личная информация</h2>
	<form id="personal_info" autocomplete="on">
		<label for="qname">ФИО (полностью):</label><br>
		<input type="text" id="qname" name="qname" size=40 minlength="5" required pattern="([а-яА-Я]+\s){2}[а-яА-Я]+$"><br>
		<label for="qemail">email:</label><br>
		<input type="text" id="qemail" name="qemail" size=40 minlength="5" required pattern="^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z]+\.[a-zA-Z]+$"><br>
	</form>
	<p><button onclick="checkInfo()" id="startTestButton">Начать Тест</button></p>
	<div id="id_clock">
		<script>digitalClock();</script>
	</div>
	<form id="questions" autocomplete="off">
		<h2>Вопросы:</h2>
		<div id="question1">
			<p><b>1. Как называется минимальная скорость, которую необходимо придать телу, стартующему на поверхности Земли, чтобы оно могло преодолеть притяжение Земли и Солнца и покинуть пределы Солнечной системы</b></p>
			<p><input name="q1" type="radio" value=1>Первая космическая</p>
			<p><input name="q1" type="radio" value=2>Вторая космическая</p>
			<p><input name="q1" type="radio" value=3>Третья космическая</p>
			<p><input name="q1" type="radio" value=4>Четвёртая космическая</p>
		</div>
		<div id="question2">
			<p><b>2. Отметьте правдивые высказывания</b></p>
			<input type="checkbox" id="q21" name="q21">
			<label for="q21">Земля плоская</label><br>
			<input type="checkbox" id="q22" name="q22">
			<label for="q22">Солнце вращается вокруг Земли</label><br>
			<input type="checkbox" id="q23" name="q23">
			<label for="q23">Луна вращается вокруг Земли</label><br>
			<input type="checkbox" id="q24" name="q24">
			<label for="q24">Земля вращается вокруг своей оси</label><br>
	</form>
</body>
</html>